<html>
<head>
	<title>IMOK</title>
	<meta http-equiv="Cache-Control" content="no-store">
	<meta http-equiv="Cache-Control: max-age=0">
			<link rel="stylesheet" href="./styles.css">
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

</head>

<body>
	<div data-role="page">
		<div data-role="header">
			<a href='imok.cgi' class="ui-btn ui-shadow ui-corner-all ui-btn-icon-notext ui-icon-delete"></a>

			<center>
				<h4>IMOK</h4>
			</center>
		</div>

		<div role="main" class="ui-content">

<h3>Settings</h3>

<form id='form_login' action='./imok.cgi'  method="post">
	<input name="command" type="hidden" value="set_settings" id='command_login'>
	<input name="tz_offset_hours" type="hidden" value="" id='tz_offset_hours'>
	<input name="timestamp" type="hidden" value="" id='timestamp'>

<br>
Type at least one email below:
<br>
<input type='text' name="email_contact_1" placeholder="email contact 1" id='email1' value='<%email_contact_1%>' autofocus>

	<input type='text' name="email_contact_2" placeholder="email contact 2" id='email2' value='<%email_contact_2%>'>

	<input type='text' name="email_contact_3" placeholder="email contact 3" id='email3' value='<%email_contact_3%>'>

	Alert Mail Message:
	</br>
	<textarea id="email form" name="email_form" rows="4" cols="40"><%email_form%></textarea>

		<label for="start_date">Alert Date</label> <input type="date"  name='start_date' id='start_date' value='<%start_date%>'>

	<label for="start_time">Alert Time</label> <input type="time" id="start_time" name="start_time" value='<%start_time%>'>

<label for="time_out">Alert Interval . Every </label>
<select name="time_out" id="time_out" value="<%time_out%>">
  <option value=".5">.5</option>
  <option value="1" selected>1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="3">4</option>
  <option value="3">5</option>
  <option value="3">6</option>
  <option value="3">7</option>
</select>	days.

<label for="time_out">Send you an email </label>
<select name="pre_warn_time" id="pre_warn_time" value="<%pre_warn_time%>">
  <option value=".5">.5</option>
  <option value="1" selected>1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="3">4</option>
  <option value="3">5</option>
  <option value="3">6</option>
  <option value="3">7</option>
</select>	hours before the Alert Date/Time. It is currently set to <b><%pre_warn_time%></b> hours.

<input type='submit' value='Save Settings' onclick="return(calc_date());">
	</form>

		</div><!-- end main -->
	</div><!-- end page -->

	<script>
function wait_icon(){
	document.getElementById('wait_icon').classList.remove('hide_me');
}

	function calc_date()
	{
		//convert yyyy-mm-dd and hh:mm to epoch time to send to server
	const date1 = new Date();
	var tz_offset_hours = date1.getTimezoneOffset() / 60 ;
	document.getElementById("tz_offset_hours").value = -tz_offset_hours;

	var start_date = document.getElementById("start_date").value; //gives us yyyy-mm-dd
	var date_ip = start_date.split('-');
	var year = date_ip[0];
	var month = parseInt(date_ip[1]) - 1; //months start at 0 in Date.UTC
	var day = date_ip[2];
	var start_time = document.getElementById("start_time").value;//gives us hh:mm
	var time_ip = start_time.split(':');
	var hour = time_ip[0];
	var minute = time_ip[1];

	var date_trigger = new Date(year, month , day , hour , minute);
	var start_UTC = Math.floor( date_trigger.getTime() / 1000 );
	if(date_trigger.getTime() < date1.getTime()){//do not allow trigger time in the past
		//alert("Trying to set a trigger time in the past. Please choose a time in the future.");
		//return 0;
		}

		if( start_date == '' || start_time == '' || document.getElementById("email1").value == '' ){
				alert("You must set 'Check In Start Date', 'Check In Start Time', and at least 'Email Contact 1'.");
				return false;
		}

	document.getElementById("timestamp").value = start_UTC; //set time stamp value to send to server
	return true;
	}

</script>

</body>
 </html>
